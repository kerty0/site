doctype html
html
    head
        block headers
            meta(charset="UTF-8")
            meta(name="viewport" content="width=device-width, initial-scale=1.0")
            title="My cat"
            link(rel="icon" href="static/favicon.ico")
            script.
                let theme = localStorage.getItem('theme') || (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
                document.documentElement.setAttribute('data-theme', theme);
            style
                include ../style.css
    body
        include header
        main
            div.title
                div
                h1
                    block title
                div(style="flex-grow: 1")
            block main
        include footer
        script.
            window.addEventListener('resize', () => {
                let img = document.querySelector('.view');
                if (img) {
                    if (window.innerWidth / window.innerHeight > img.naturalWidth / img.naturalHeight) {
                        img.style.height = '100%';
                        img.style.width = '';
                    } else {
                        img.style.width = '100%';
                        img.style.height = '';
                    }
                }
            });
            window.addEventListener('keydown', (event) => {
                let img = document.querySelector('.view');
                if (img) {
                    if (event.key === 'Escape') {
                        closeViewer(img);
                    }
                }
            });
            function closeViewer(img) {
                img.classList.remove('view')
                img.parentElement.classList.remove('background-active')
                img.style.width = '';
                img.style.height = '';
            }
            const maxImgHeight = `${window.outerHeight * 0.5}px`;
            document.querySelectorAll('main img').forEach((img) => {
                img.outerHTML = `<div class="imgbox" style="height: min(${img.naturalHeight}px, ${maxImgHeight})"><div class="background">${img.outerHTML}</div></div>`;
            });
            document.querySelectorAll('main img').forEach((img) => {
                img.addEventListener('click', () => {
                    if (document.querySelector('.view')) {
                        closeViewer(img)
                    } else {
                        img.classList.add('view');
                        img.parentElement.classList.add('background-active')
                        window.dispatchEvent(new CustomEvent('resize'));
                    }
                });
            });